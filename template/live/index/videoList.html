<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no" />
	    <title>视频列表</title>
	    <link rel="stylesheet" href="__STATIC__/css/public/base.css">
	    <link rel="stylesheet" href="__STATIC__/css/public/head.css">
	    <script src="__STATIC__/js/public/rem.js"></script>
		<link rel="stylesheet" type="text/css" href="__STATIC__/css/index/index.css"/>
	</head>
	<body>
		<div class="wrapper">
			<!--头部-->
			<div class="public_head">
		        <i class="iconfont head_icon" onclick="window.history.back();">&#xe63f;</i>
		        <p>视频列表</p>
		    </div>
			<!--内容-->
			<div class="content">
				<div class="item_wrap" id="videoList"></div>

				<div class="getmore" style="font-size:.32rem;text-align:center;color:#888;padding:.25rem .24rem .4rem; clear:both;display: none">
					<a href="javascript:void(0)">点击加载更多</a>
				</div>
				<div class="nomore">已显示完所有直播</div>
			</div>
			<!--直播按钮-->
			<if condition='$zhubo eq 1'>
				<div class="live_btn">
					<a class="ive" href="{:U('Live/Index/set')}">
						<div>直播</div>
					</a>
				</div>
			</if>
		</div>
	</body>
    <script src="__STATIC__/js/public/jquery-3.3.1.min.js"></script>
    <script src="__PUBLIC__/js/global.js"></script>
    <script src="__STATIC__/js/layer.js?v=22222"  type="text/javascript" ></script>
    <script type="text/javascript">
    
  var now_time =  Math.round(new Date().getTime()/1000)
  alert(now_time);
        $(function () {
            var list = {
                page: 1,
                list: $('#videoList'),
                getMore: $('.getmore'),
                noMore: $('.nomore'),
                init: function () {
                    var that = this;
                    that.load();
                    $(document).on('click', '.getmore', function () {
                        that.load();
                    })
                },
                load: function () {
                    var that = this;
                    that.hideGetMore();
                    that.hideNoMore();
                    $.ajax({
                        type: 'GET',
						url:"{:U('live/index/ajaxvideolist')}",
						data: {p: that.page},
                        success: function (data) {
                            that.list.append(data.content);
                            that.hasMore(data);
                            that.showNoMore(data);
                        }
                    });
                    return false;
                },
                hasMore: function (data) {
                    if (data.count > data.current_count && data.list_count == data.page_count) {
                        this.page++;
                        this.showGetMore();
                    }
                },
                showGetMore: function () {
                    if (this.getMore) this.getMore.show();
                },
                hideGetMore: function () {
                    if (this.getMore) this.getMore.hide();
                },
                showNoMore: function (data) {
                    if (data.count <= data.current_count && data.count > 0) {
                        this.noMore.show();
                    }
                },
                hideNoMore: function () {
                    if (this.noMore) this.noMore.hide();
                }
            };
            list.init();
        });

	</script>
</html>
